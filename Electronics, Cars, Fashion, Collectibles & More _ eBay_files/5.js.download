"use strict";var DEFAULT_COOKIE_FORMAT={COOKIELET_DELIMITER:"^",NAME_VALUE_DELIMITER:"/",escapedValue:!0},DP_COOKIE_FORMAT={COOKIELET_DELIMITER:"^",NAME_VALUE_DELIMITER:"/",bUseExp:!0,startDelim:"b"},SESSION_COOKIE_FORMAT={COOKIELET_DELIMITER:"^",NAME_VALUE_DELIMITER:"=",escapedValue:!0,startDelim:"^"},DS_COOKIE_FORMAT={COOKIELET_DELIMITER:"^",NAME_VALUE_DELIMITER:"/"},sPath="/",aConversionMap={reg:["dp1","reg"],recent_vi:["ebay","lvmn"],ebaysignin:["ebay","sin"],p:["dp1","p"],etfc:["dp1","etfc"],keepmesignin:["dp1","kms"],ItemList:["ebay","wl"],BackToList:["s","BIBO_BACK_TO_LIST"]},aFormatMap={r:DEFAULT_COOKIE_FORMAT,dp1:DP_COOKIE_FORMAT,npii:DP_COOKIE_FORMAT,ebay:SESSION_COOKIE_FORMAT,reg:SESSION_COOKIE_FORMAT,apcCookies:SESSION_COOKIE_FORMAT,ds2:DS_COOKIE_FORMAT},sCOMPAT="10",sCONVER="01",sSTRICT="00",sModesCookie="ebay",sModesCookielet="cv",api={readCookie:function(e,t){var i=this.readCookieObj(e,t).value;return i?(this.getFormat(e).escapedValue&&(i=decodeURIComponent(i)),i):""},async readCookieAsync(e,t){if(!this.isCookieStoreAvialable())return this.readCookie(e,t);var i=(await this.readCookieObjAsync(e,t)).value;return i?(this.getFormat(e).escapedValue&&(i=decodeURIComponent(i)),i):""},createDefaultCookieBean:function(e,t){var i={};return i.name=e,i.cookieletname=t,i.value="",i.maxage=0,i.rawcookievalue="",i.mode="",i},readCookieObjCommon:function(e){this.checkConversionMap(e),e.rawcookievalue=this.aCookies[e.name],e.name&&e.rawcookievalue?e.cookieletname?this.readCookieletInternal(e):this.readCookieInternal(e):e.value="";var t=e.cookieletname&&e.cookieletname.match(/guid$/),i=void 0!==e?e:"";return i&&t&&e.value.length>32&&(e.value=e.value.substring(0,32)),i},readCookieObjAsync:async function(e,t){var i=this.createDefaultCookieBean(e,t);return await this.updateAsync(),this.readCookieObjCommon(i)},readCookieObj:function(e,t){var i=this.createDefaultCookieBean(e,t);return this.update(),this.readCookieObjCommon(i)},checkConversionMap:function(e){var t=aConversionMap[e.name];t&&(e.mode=this.getMode(e.name),e.name=t[0],e.cookieletname=t[1])},readCookieInternal:function(e){return e.value=e.rawcookievalue,e},readCookieletInternal:function(e){var t=this.getCookielet(e.name,e.cookieletname,e.rawcookievalue),i=this.getFormat(e.name);if(t&&i.bUseExp){var o=t;t=t.substring(0,t.length-8),o.length>8&&(e.maxage=o.substring(o.length-8))}return e.value=t,e.mode==sCOMPAT&&(e.value=e.rawcookievalue),e},readMultiLineCookie:function(e,t){if(!e||!t)return"";var i,o="",n=aConversionMap[e];return n&&(i=this.readCookieObj(n[0],n[1]).value||""),i&&(o=this.getCookielet(e,t,i)||""),void 0!==o?o:""},readMultiLineCookieAsync:async function(e,t){if(!e||!t)return"";var i,o="",n=aConversionMap[e];return n&&(i=await this.readCookieObjAsync(n[0],n[1]).value||""),i&&(o=this.getCookielet(e,t,i)||""),void 0!==o?o:""},writeCookie:function(e,t,i){var o=aConversionMap[e];if(o)this.writeCookielet(o[0],o[1],t,i);else{var n=this.getFormat(e);t&&n.escapedValue&&(t=encodeURIComponent(t)),this.writeRawCookie(e,t,i)}},writeCookieAsync:async function(e,t,i){var o=aConversionMap[e];if(o)await this.writeCookieletAsync(o[0],o[1],t,i);else{var n=this.getFormat(e);t&&n.escapedValue&&(t=encodeURIComponent(t)),this.isCookieStoreAvialable()?await this.writeRawCookieAsync(e,t,i):this.writeRawCookie(e,t,i)}},prepareCookie:function(e,t,i){if(e&&void 0!==t&&(isNaN(t)&&t.length<4e3||(t+"").length<4e3)){"number"==typeof i&&(i=this.getExpDate(i));var o=i?new Date(i):new Date(this.getExpDate(730)),n=this.getFormat(e),a=this.sCookieDomain,r=document.domain;if(-1===r.indexOf(a)){var s=r.indexOf(".ebay.");s>0&&(this.sCookieDomain=r.substring(s))}return{name:e,value:t||"",expires:i||n.bUseExp?o.toGMTString():"",domain:this.sCookieDomain,path:sPath}}return null},writeRawCookie:function(e,t,i){var o=this.prepareCookie(e,t,i);o&&document.cookie&&(document.cookie=o.name+"="+o.value+(o.expires?"; expires="+o.expires:"")+"; domain="+o.domain+"; path="+o.path)},writeRawCookieAsync:async function(e,t,i){var o=this.prepareCookie(e,t,i);(o=this.convertCookieToCookieStore(o))&&window.cookieStore&&await window.cookieStore.set(o)},convertCookieToCookieStore:function(e){return{name:e.name,value:e.value,domain:e.domain.replace(/^\./,""),expires:""==e.expires?null:new Date(e.expires),path:e.path}},writeCookieEx:function(e,t,i){this.writeCookie(e,t,this.getExpDate(i))},prepareCookielet:function(e,t,i,o){if(e&&t){if(this.getFormat(e).bUseExp&&i){"number"==typeof o&&(o=this.getExpDate(o));var n=o?new Date(o):new Date(this.getExpDate(730)),a=Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds());a=Math.floor(a/1e3),i+=parseInt(a,10).toString(16)}return this.createCookieValue(e,t,i)}return null},writeCookielet:function(e,t,i,o,n){this.update();var a=this.prepareCookielet(e,t,i,o);a&&this.writeRawCookie(e,a,n)},writeCookieletAsync:async function(e,t,i,o,n){await this.updateAsync();var a=this.prepareCookielet(e,t,i,o);a&&(this.isCookieStoreAvialable()?await this.writeRawCookieAsync(e,a,n):this.writeRawCookie(e,a,n))},writeMultiLineCookie:function(e,t,i,o,n){this.update();var a=this.createCookieValue(e,t,i);if(a){var r=aConversionMap[e];r&&this.writeCookielet(r[0],r[1],a,o,n)}},getBitFlagOldVersion:function(e,t){var i=parseInt(e,10),o=i.toString(2);return"1"==(i?o.charAt(o.length-t-1):"")?1:0},setBitFlagOldVersion:function(e,t,i){var o,n,a,r,s="";if((e=parseInt(e+"",10))&&(s=e.toString(2)),(r=s.length)<t)for(a=t-r,n=0;n<=a;n++)s="0"+s;return o=s.length-t-1,parseInt(s.substring(0,o)+i+s.substring(o+1),2)},getBitFlag:function(e,t){if(null!==e&&e.length>0&&"#"===e.charAt(0)){var i=t%4,o=e.length-(Math.floor(t/4)+1),n=1<<i;return(parseInt(e.substring(o,o+1),16)&n)==n?1:0}return this.getBitFlagOldVersion(e,t)},setBitFlag:function(e,t,i){if(null!==e&&e.length>0&&"#"===e.charAt(0)){var o=e.length,n=t%4,a=Math.floor(t/4)+1;if(o<=a){if(1!=i)return e;for(var r=a-o+1,s=e.substring(1,o);r>0;)s="0"+s,r--;o=(e="#"+s).length}var u=o-a,l=parseInt(e.substring(u,u+1),16),C=1<<n;return 1==i?l|=C:l&=~C,e=e.substring(0,u)+l.toString(16)+e.substring(u+1,o)}return t>31?e:this.setBitFlagOldVersion(e,t,i)},createCookieValue:function(e,t,i){var o,n=aConversionMap[e],a=this.getFormat(e),r=this.getMode(e);if(o=!n||r!=sSTRICT&&r!=sCONVER?this.aCookies[e]||"":this.readCookieObj(n[0],n[1]).value||"",a){var s=this.getCookieletArray(o,a);s[t]=i;var u="";for(var l in s)s.hasOwnProperty(l)&&(u+=l+a.NAME_VALUE_DELIMITER+s[l]+a.COOKIELET_DELIMITER);u&&a.startDelim&&(u=a.startDelim+u),o=u,a.escapedValue&&(o=encodeURIComponent(o))}return o},updateAsync:async function(){if(this.isCookieStoreAvialable()){const e=await window.cookieStore.getAll();this.aCookies={};const t=new RegExp('^"(.*)"$');for(let i=0;i<e.length;i++){const o=this.getFormat(e[i].name),n=e[i].value,a=o.startDelim;a&&n&&0===n.indexOf(a)&&(e[i].value=n.substring(a.length,n.length)),e[i].value&&e[i].value.match(t)&&(e[i].value=e[i].value.substring(1,e[i].value.length-1)),this.aCookies[e[i].name]=e[i].value}}},isCookieStoreAvialable:function(){return!!window.cookieStore},update:function(){var e=document.cookie.split("; ");this.aCookies={};for(var t=new RegExp('^"(.*)"$'),i=0;i<e.length;i++){var o=e[i].split("="),n=this.getFormat(o[0]),a=o[1],r=n.startDelim;r&&a&&0===a.indexOf(r)&&(o[1]=a.substring(r.length,a.length)),o[1]&&o[1].match(t)&&(o[1]=o[1].substring(1,o[1].length-1)),this.aCookies[o[0]]=o[1]}},getCookielet:function(e,t,i){var o=this.getFormat(e);return this.getCookieletArray(i,o)[t]||""},getFormat:function(e){return aFormatMap[e]||DEFAULT_COOKIE_FORMAT},getCookieletArray:function(e,t){var i=[],o=e||"";t.escapedValue&&(o=decodeURIComponent(o));for(var n=o.split(t.COOKIELET_DELIMITER),a=0;a<n.length;a++){var r=n[a].indexOf(t.NAME_VALUE_DELIMITER);r>0&&(i[n[a].substring(0,r)]=n[a].substring(r+1))}return i},getExpDate:function(e){var t;if("number"==typeof e&&e>=0){var i=new Date;i.setTime(i.getTime()+24*e*60*60*1e3),t=i.toGMTString()}return t},getMode:function(e){var t,i,o=this.readCookieObj(sModesCookie,sModesCookielet).value;if(!(e in aConversionMap))return null;if(!o)return"";if(0===o)return sSTRICT;if(o&&"0"!=o){if(-1!==o.indexOf(".")){var n=o.split(".");for(i=0;i<n.length;i++)t=parseInt(n[i],16).toString(2)+t}else t=parseInt(o,16).toString(2);i=0;var a,r=t.length;for(var s in aConversionMap){a=r-2*(i+1);var u=t.substring(a,a+2).toString(10);if(u=u||sSTRICT,e==s)return 1===u.length?"0"+u:u;i++}return null}return null},getMulti:function(e,t,i){var o,n="";for(o=0;o<i;o++)n=this.getBitFlag(e,t+o)+n;return parseInt(n,2)},setMulti:function(e,t,i,o){var n,a,r,s=0;if((a=(n=o.toString(2).substring(0,i)).length)<i){r=i-a;for(var u=0;u<r;u++)n="0"+n;a+=r}for(s=0;s<a;s++)e=this.setBitFlag(e,t+s,n.substring(a-s-1,a-s));return e},setJsCookie:function(){this.writeCookielet("ebay","js","1")}};function eventInit(){var e=function(){api.setJsCookie()};window.addEventListener?window.addEventListener("beforeunload",e):window.attachEvent&&window.attachEvent("onbeforeunload",e)}"undefined"!=typeof window&&(eventInit(),window["@ebay/cookies-browser"]=api,window["cookies-browser"]=api),"undefined"!=typeof module&&module.exports&&(module.exports=api);